var S=Object.defineProperty;var L=(k,t)=>S(k,"name",{value:t,configurable:!0});class B{static{L(this,"GameOverSystem")}constructor(t){this.apiBase="https://api.blockzonelab.com",this.isVisible=!1,this.currentScore=0,this.identitySystem=null,this.eventBus=t,this.identityCache=null,this.cacheTimestamp=0,this.CACHE_DURATION=3e4,this.pendingAPIResponse=null,this.cachedLeaderboardData=null,this.currentGameScore=null,this.apiCallInProgress=!1,this.LOG_LEVEL={ERROR:0,WARN:1,INFO:2,DEBUG:3},this.currentLogLevel=this.LOG_LEVEL.INFO}setIdentitySystem(t){this.identitySystem=t}log(t,e,o=null){t<=this.currentLogLevel&&(o?console.log(e,o):console.log(e))}getCurrentGameSession(){const t=this.getPlayerId(),e=Math.floor(Date.now()/1e3);return`${t}_${e}`}resetGameOverState(){this.gameOverApiCallMade=!1,this.currentGameSession=null,this.lastLeaderboardData=null,this.identityCache=null,this.cacheTimestamp=0,this.pendingAPIResponse=null,this.cachedLeaderboardData=null,this.currentGameScore=null,this.apiCallInProgress=!1,this.log(this.LOG_LEVEL.INFO,"\u{1F504} Game over state reset for new game")}hasLeaderboardDataChanged(t){if(!this.lastLeaderboardData)return!0;const e=this.lastLeaderboardData,o=t.scores||[],r=e.scores||[];if(o.length!==r.length)return!0;for(let n=0;n<Math.min(3,o.length);n++)if(!r[n]||r[n].score!==o[n].score||r[n].display_name!==o[n].display_name)return!0;return!1}async show(t,e={}){this.log(this.LOG_LEVEL.INFO,"\u{1F3AE} GameOverSystem.show() called",{data:t,metrics:e});let o;if(typeof t=="object"&&t.score!==void 0)o=t.score,this.log(this.LOG_LEVEL.DEBUG,"\u{1F3AE} Extracted score from data object:",o);else if(typeof t=="number")o=t,this.log(this.LOG_LEVEL.DEBUG,"\u{1F3AE} Using direct score value:",o);else{this.log(this.LOG_LEVEL.ERROR,"\u274C Invalid score data:",t);return}if(this.isVisible){this.log(this.LOG_LEVEL.WARN,"\u26A0\uFE0F GameOverSystem already visible, returning early");return}this.isVisible=!0,this.currentScore=o,this.log(this.LOG_LEVEL.INFO,"\u26A1 INSTANT: Creating overlay with hard-coded medal positions"),this.createOverlayWithHardcodedMedals(o);const{playerName:r,playerID:n}=await this.getIdentityDataOnce();if(this.log(this.LOG_LEVEL.INFO,"\u26A1 INSTANT: Updating overlay with player info"),this.updateOverlayWithPlayerInfo(o,r,n),this.log(this.LOG_LEVEL.INFO,"\u{1F680} Starting immediate API call for leaderboard data"),this.startBackgroundAPICalls(o,r,n),await this.checkEmailRequirement(r,n)){this.log(this.LOG_LEVEL.INFO,"\u{1F4E7} Email capture needed - showing email modal first");const i=await this.showEmailCaptureBeforeGameOver(o,r,n);this.log(this.LOG_LEVEL.INFO,"\u{1F4E7} Email capture completed:",i),await this.updateGameOverUIWithFreshData(o,r,n)}else this.log(this.LOG_LEVEL.INFO,"\u{1F4E7} Email capture not needed - API call already started during visual sequence")}async checkEmailRequirement(t,e){const o=t.startsWith("Player#"),r=localStorage.getItem("blockzone_player_profile");if(r)try{const a=JSON.parse(r),d=Date.now()-(a.lastSession||0)<7*24*60*60*1e3;if(a.displayName&&a.displayName.includes("#")&&d){if(console.log("\u{1F50D} Device recognition: Found saved player profile:",a.displayName),window.gameWrapper?.identityManager?.playerIdentity){const c=window.gameWrapper.identityManager.getCurrentPlayer();c&&(c.displayName=a.displayName,c.hasCustomName=!0,c.username=a.displayName.split("#")[0],c.email=a.email,await window.gameWrapper.identityManager.playerIdentity.saveToStorage(c),console.log("\u2705 Player identity restored from device recognition"))}return console.log("\u{1F50D} Email requirement check: Device recognized, no capture needed"),!1}}catch(a){console.error("\u274C Error parsing saved profile:",a)}const n=o;return console.log("\u{1F50D} Email requirement check:",{playerName:t,isAnonymous:o,needsCapture:n,hasDeviceProfile:!!r}),n}async showEmailCaptureBeforeGameOver(t,e,o){return console.log("\u{1F4E7} Showing email capture modal for leaderboard name"),new Promise(r=>{this.blockGameInteraction();const n=document.createElement("div");n.id="email-capture-modal",n.style.cssText=`
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                font-family: 'Bungee', monospace;
            `,n.innerHTML=`
                <div style="
                    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
                    border: 2px solid #00d4ff;
                    border-radius: 15px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
                ">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px;">\u{1F3C6} Get on the Leaderboard!</h2>
                    <p style="color: #ffffff; margin-bottom: 25px; font-size: 16px; line-height: 1.5;">Enter your name and contact info to appear on the leaderboard instead of "${e}"</p>
                    
                    <input type="text" id="player-name-input" placeholder="Enter your name" style="
                        width: 100%;
                        padding: 12px;
                        margin-bottom: 15px;
                        border: 2px solid #00d4ff;
                        border-radius: 8px;
                        background: rgba(0, 0, 0, 0.7);
                        color: #ffffff;
                        font-size: 16px;
                        font-family: 'Bungee', monospace;
                        text-align: center;
                    " maxlength="30">
                    
                    <!-- Social Media Options -->
                    <div style="margin-bottom: 15px;">
                        <p style="color: #cccccc; font-size: 14px; margin-bottom: 10px;">Connect with social media (required for scoreboard):</p>
                        <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;">
                            <button type="button" id="instagram-btn" style="
                                background: linear-gradient(45deg, #E4405F, #C13584);
                                color: white;
                                border: none;
                                padding: 10px 15px;
                                border-radius: 8px;
                                font-size: 14px;
                                cursor: pointer;
                                font-family: 'Bungee', monospace;
                                transition: all 0.3s;
                            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                \u{1F4F7} Instagram
                            </button>
                            
                            <button type="button" id="tiktok-btn" style="
                                background: linear-gradient(45deg, #000000, #ff0050);
                                color: white;
                                border: none;
                                padding: 10px 15px;
                                border-radius: 8px;
                                font-size: 14px;
                                cursor: pointer;
                                font-family: 'Bungee', monospace;
                                transition: all 0.3s;
                            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                \u{1F3A5} TikTok
                            </button>
                            
                            <button type="button" id="twitter-btn" style="
                                background: linear-gradient(45deg, #1DA1F2, #0d8bd9);
                                color: white;
                                border: none;
                                padding: 10px 15px;
                                border-radius: 8px;
                                font-size: 14px;
                                cursor: pointer;
                                font-family: 'Bungee', monospace;
                                transition: all 0.3s;
                            " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                                \u{1F426} Twitter
                            </button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 15px; color: #888888; font-size: 14px;">OR</div>
                    
                    <input type="email" id="player-email-input" placeholder="Email (required for scoreboard)" style="
                        width: 100%;
                        padding: 12px;
                        margin-bottom: 20px;
                        border: 2px solid #00d4ff;
                        border-radius: 8px;
                        background: rgba(0, 0, 0, 0.7);
                        color: #ffffff;
                        font-size: 16px;
                        font-family: 'Bungee', monospace;
                        text-align: center;
                    ">
                    
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button id="save-name-btn" style="
                            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
                            color: #000000;
                            border: none;
                            padding: 12px 25px;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: bold;
                            cursor: pointer;
                            font-family: 'Bungee', monospace;
                            transition: all 0.3s;
                        ">\u{1F4BE} Save & Continue</button>
                        
                        <button id="skip-name-btn" style="
                            background: transparent;
                            color: #888888;
                            border: 2px solid #555555;
                            padding: 12px 25px;
                            border-radius: 8px;
                            font-size: 16px;
                            cursor: pointer;
                            font-family: 'Bungee', monospace;
                            transition: all 0.3s;
                        ">Skip</button>
                    </div>
                </div>
            `,document.body.appendChild(n);const a=n.querySelector("#player-name-input"),i=n.querySelector("#player-email-input"),d=n.querySelector("#save-name-btn"),c=n.querySelector("#skip-name-btn");setTimeout(()=>a.focus(),100);const s=n.querySelector("#instagram-btn"),u=n.querySelector("#tiktok-btn"),f=n.querySelector("#twitter-btn");let y=null;const l=L(async p=>{console.log(`\u{1F4F1} Starting ${p} OAuth login`);try{const m=n.querySelector(`#${p.toLowerCase()}-btn`);m&&(m.textContent="Connecting...",m.disabled=!0);const g=await this.initiateOAuthFlow(p);if(g.success)y=p,[s,u,f].forEach(b=>{b&&(b.style.opacity="0.5")}),m&&(m.style.opacity="1",m.style.boxShadow="0 0 20px rgba(0, 255, 136, 0.5)",m.textContent=`\u2705 ${p} Connected`),g.profile.username&&(a.value=g.profile.username,a.placeholder=`${p} handle: ${g.profile.username}`),this.socialAuthData={platform:p,profile:g.profile,accessToken:g.accessToken},console.log(`\u2705 ${p} OAuth successful:`,g.profile);else throw new Error(g.error||"OAuth failed")}catch(m){console.error(`\u274C ${p} OAuth failed:`,m);const g=n.querySelector(`#${p.toLowerCase()}-btn`);g&&(g.textContent=`\u274C Try ${p} Again`,g.disabled=!1,g.style.opacity="0.7");const b=document.createElement("div");b.style.cssText="color: #ff4444; font-size: 12px; margin-top: 5px; text-align: center;",b.textContent=`${p} connection failed. You can still enter your name manually.`,g.parentNode.appendChild(b),setTimeout(()=>b.remove(),5e3)}},"handleSocialLogin");s&&s.addEventListener("click",()=>l("Instagram")),u&&u.addEventListener("click",()=>l("TikTok")),f&&f.addEventListener("click",()=>l("Twitter"));const x=L(async()=>{const p=a.value.trim(),m=i.value.trim();if(!p){a.style.borderColor="#ff4444",a.placeholder="Name is required!";return}if(!m&&!y){i.style.borderColor="#ff4444",i.placeholder="Email or social media required!";return}console.log("\u{1F4BE} Saving player name and comprehensive profile data:",{playerName:p,playerEmail:m});try{const g=window.gameWrapper?.identityManager?.getCurrentPlayer(),b=g?.walletSuffix||g?.id?.slice(-4)?.toUpperCase()||"0000",h=`${p}#${b}`;if(console.log("\u{1F3AF} Creating composite display name:",h),window.gameWrapper&&window.gameWrapper.identityManager&&(await window.gameWrapper.identityManager.updateWithCustomName(p)?console.log("\u2705 Player identity enhanced with custom name"):console.warn("\u26A0\uFE0F Failed to update player name")),window.playerProfile){const v={lastGameScore:t,lastGameMoves:window.neonDrop?.gameEngine?.moves||0,lastGameLevel:window.neonDrop?.gameEngine?.level||1,lastGameLines:window.neonDrop?.gameEngine?.linesCleared||0,lastGameTime:window.neonDrop?.gameEngine?.gameTime||0,gamesPlayedToday:(window.playerProfile.cache.status?.data?.games_played_today||0)+1,freeGamesUsed:window.playerProfile.cache.status?.data?.has_used_free_game||!1,displayName:h,email:m,lastPlayed:new Date().toISOString()};console.log("\u{1F4CA} Comprehensive game statistics:",v),localStorage.setItem("blockzone_player_profile",JSON.stringify({displayName:h,email:m,playerId:o,walletSuffix:b,deviceFingerprint:window.gameWrapper.identityManager.generateFingerprint(),lastSession:Date.now(),gameStats:v})),console.log("\u{1F4BE} Player profile saved to localStorage for device recognition")}console.log("\u{1F504} Re-submitting score with composite name:",h),await this.submitScore(t,h,o)}catch(g){console.error("\u274C Failed to update comprehensive player profile:",g)}document.body.removeChild(n),this.unblockGameInteraction(),r({playerName:p,playerEmail:m,socialPlatform:y})},"handleSave"),w=L(()=>{console.log("\u23ED\uFE0F Player skipped name entry"),document.body.removeChild(n),this.unblockGameInteraction(),r(!1)},"handleSkip");d.addEventListener("click",x),c.addEventListener("click",w),a.addEventListener("keypress",p=>{p.key==="Enter"&&x()}),i.addEventListener("keypress",p=>{p.key==="Enter"&&x()}),document.addEventListener("keydown",L(function p(m){m.key==="Escape"&&(document.removeEventListener("keydown",p),w())},"escapeHandler"))})}blockGameInteraction(){console.log("\u{1F6AB} Blocking game interaction"),window.neonDrop&&window.neonDrop.gameEngine&&(window.neonDrop.gameEngine.inputBlocked=!0);const t=document.createElement("div");t.id="game-interaction-blocker",t.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 9999;
            pointer-events: all;
        `;const e=document.getElementById("game");e&&e.parentNode?e.parentNode.appendChild(t):document.body.appendChild(t)}unblockGameInteraction(){console.log("\u2705 Unblocking game interaction"),window.neonDrop&&window.neonDrop.gameEngine&&(window.neonDrop.gameEngine.inputBlocked=!1);const t=document.getElementById("game-interaction-blocker");t&&t.remove()}async initiateOAuthFlow(t){const e={Instagram:"your_instagram_client_id",TikTok:"your_tiktok_client_id",Twitter:"your_twitter_client_id"},o=`${window.location.origin}/auth/callback`;try{switch(t){case"Instagram":return await this.handleInstagramAuth(e.Instagram,o);case"TikTok":return await this.handleTikTokAuth(e.TikTok,o);case"Twitter":return await this.handleTwitterAuth(e.Twitter,o);default:throw new Error(`Unsupported platform: ${t}`)}}catch(r){return console.error(`OAuth flow failed for ${t}:`,r),{success:!1,error:r.message}}}async handleInstagramAuth(t,e){const r=`https://api.instagram.com/oauth/authorize?client_id=${t}&redirect_uri=${encodeURIComponent(e)}&scope=user_profile,user_media&response_type=code`;return new Promise(n=>{const a=window.open(r,"instagram-auth","width=500,height=600,scrollbars=yes,resizable=yes"),i=setInterval(()=>{a.closed&&(clearInterval(i),n({success:!1,error:"User cancelled authentication"}))},1e3);window.addEventListener("message",async d=>{if(d.origin===window.location.origin&&d.data.type==="instagram-auth-success"){clearInterval(i),a.close();try{const s=await(await fetch("/api/auth/instagram/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d.data.code})})).json();s.success?n({success:!0,accessToken:s.access_token,profile:{username:s.username,id:s.user_id,platform:"Instagram"}}):n({success:!1,error:"Failed to get access token"})}catch(c){n({success:!1,error:c.message})}}},{once:!0})})}async handleTikTokAuth(t,e){const r=`https://www.tiktok.com/auth/authorize/?client_key=${t}&scope=user.info.basic&response_type=code&redirect_uri=${encodeURIComponent(e)}`;return new Promise(n=>{const a=window.open(r,"tiktok-auth","width=500,height=600,scrollbars=yes,resizable=yes"),i=setInterval(()=>{a.closed&&(clearInterval(i),n({success:!1,error:"User cancelled authentication"}))},1e3);window.addEventListener("message",async d=>{if(d.origin===window.location.origin&&d.data.type==="tiktok-auth-success"){clearInterval(i),a.close();try{const s=await(await fetch("/api/auth/tiktok/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d.data.code})})).json();s.success?n({success:!0,accessToken:s.access_token,profile:{username:s.username,id:s.user_id,platform:"TikTok"}}):n({success:!1,error:"Failed to get access token"})}catch(c){n({success:!1,error:c.message})}}},{once:!0})})}async handleTwitterAuth(t,e){const r=`https://twitter.com/i/oauth2/authorize?response_type=code&client_id=${t}&redirect_uri=${encodeURIComponent(e)}&scope=${encodeURIComponent("tweet.read users.read")}&state=state&code_challenge=challenge&code_challenge_method=plain`;return new Promise(n=>{const a=window.open(r,"twitter-auth","width=500,height=600,scrollbars=yes,resizable=yes"),i=setInterval(()=>{a.closed&&(clearInterval(i),n({success:!1,error:"User cancelled authentication"}))},1e3);window.addEventListener("message",async d=>{if(d.origin===window.location.origin&&d.data.type==="twitter-auth-success"){clearInterval(i),a.close();try{const s=await(await fetch("/api/auth/twitter/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:d.data.code})})).json();s.success?n({success:!0,accessToken:s.access_token,profile:{username:s.username,id:s.user_id,platform:"Twitter"}}):n({success:!1,error:"Failed to get access token"})}catch(c){n({success:!1,error:c.message})}}},{once:!0})})}async showGameOverScreenInstant(t,e,o,r){this.log(this.LOG_LEVEL.INFO,"\u26A1 INSTANT: Showing game over screen with local data"),this.showWrapperInterface(t,e,o,r),this.overlayPerformance&&this.overlayPerformance.markInstantDisplay();const n=document.getElementById("game-over-wrapper");n&&this.showLoadingStates(n),this.log(this.LOG_LEVEL.INFO,"\u{1F680} Starting immediate API call for leaderboard data"),this.startBackgroundAPICalls(t,o,r),this.log(this.LOG_LEVEL.INFO,"\u26A1 INSTANT: Game over screen displayed with local data")}startBackgroundAPICalls(t,e=null,o=null){if(this.cachedLeaderboardData&&this.cachedLeaderboardData.score===t)return this.log(this.LOG_LEVEL.INFO,"\u{1F4CA} Using cached leaderboard data for overlay"),this.updateLeaderboardInOverlay(this.cachedLeaderboardData),Promise.resolve(this.cachedLeaderboardData);if(this.apiCallInProgress&&this.currentGameScore===t)return this.log(this.LOG_LEVEL.WARN,"\u23F3 API call already in progress for this score, waiting..."),this.waitForApiResult();this.apiCallInProgress=!0,this.currentGameScore=t,this.log(this.LOG_LEVEL.INFO,"\u{1F680} Starting API call for score:",t);const r=e||this.getPlayerName(),n=o||this.getPlayerId();return fetch(`${this.apiBase}/api/game-over`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({score:t,playerId:n,gameData:{playerName:r,gameType:"neon_drop",timestamp:Date.now()}})}).then(a=>a.json()).then(()=>fetch(`${this.apiBase}/api/leaderboard`)).then(a=>a.json()).then(a=>(this.log(this.LOG_LEVEL.INFO,"\u2705 Got leaderboard data:",a),this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} API Response structure:",{hasScores:!!a.scores,scoresLength:a.scores?.length,firstScore:a.scores?.[0],scoreKeys:a.scores?.[0]?Object.keys(a.scores[0]):[]}),a.scores&&a.scores.length>0&&this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} First 3 scores detail:",a.scores.slice(0,3).map((i,d)=>({position:d+1,display_name:i.display_name,player_id:i.player_id,id:i.id,score:i.score,allKeys:Object.keys(i)}))),this.cachedLeaderboardData={score:t,...a},this.pendingAPIResponse=a,this.hasLeaderboardDataChanged(a)?(this.updateLeaderboardInOverlay(a),this.lastLeaderboardData={...a}):this.log(this.LOG_LEVEL.DEBUG,"\u{1F504} Leaderboard data unchanged, skipping update"),this.cachedLeaderboardData)).catch(a=>{throw this.log(this.LOG_LEVEL.ERROR,"\u274C API call failed:",a),a}).finally(()=>{this.apiCallInProgress=!1,this.log(this.LOG_LEVEL.DEBUG,"\u{1F513} API call guard reset")})}waitForApiResult(){return new Promise((t,e)=>{const o=setInterval(()=>{this.cachedLeaderboardData&&this.cachedLeaderboardData.score===this.currentGameScore?(clearInterval(o),this.log(this.LOG_LEVEL.INFO,"\u{1F4CA} API result ready, returning cached data"),t(this.cachedLeaderboardData)):this.apiCallInProgress||(clearInterval(o),this.log(this.LOG_LEVEL.ERROR,"\u274C API call failed while waiting"),e(new Error("API call failed")))},100);setTimeout(()=>{clearInterval(o),this.log(this.LOG_LEVEL.ERROR,"\u274C Timeout waiting for API result"),e(new Error("API call timeout"))},1e4)})}updateLeaderboardInOverlay(t){this.log(this.LOG_LEVEL.INFO,"\u{1F3C6} updateLeaderboardInOverlay called");const e=document.getElementById("game-over-wrapper");if(!e){this.log(this.LOG_LEVEL.ERROR,"\u274C No game-over-wrapper found");return}const o=e.querySelector("#leaderboardContent");if(!o){this.log(this.LOG_LEVEL.ERROR,"\u274C No leaderboardContent found");return}const r=t.scores?t.scores.slice(0,3):[];this.log(this.LOG_LEVEL.DEBUG,"\u{1F3C6} Top 3 players:",r);const n=this.getPlayerId();this.log(this.LOG_LEVEL.DEBUG,"\u{1F3C6} Current player ID for comparison:",n);let a="";const i=r[0],d=i?i.display_name:"No Data",c=i&&i.score?i.score.toLocaleString():"No Data",s=i&&(i.player_id||i.id)||"",u=s===n;a+=`<div style="color: ${u?"#00ff88":"#ffffff"}; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
            \u{1F947} 1st: ${d} - ${c} pts${u?" \u2190 You":""}
        </div>`;const l=r[1],x=l?l.display_name:"No Data",w=l&&l.score?l.score.toLocaleString():"No Data",p=l&&(l.player_id||l.id)||"",m=p===n;a+=`<div style="color: ${m?"#00ff88":"#ffffff"}; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
            \u{1F948} 2nd: ${x} - ${w} pts${m?" \u2190 You":""}
        </div>`;const h=r[2],v=h?h.display_name:"No Data",O=h&&h.score?h.score.toLocaleString():"No Data",I=h&&(h.player_id||h.id)||"",E=I===n;a+=`<div style="color: ${E?"#00ff88":"#ffffff"}; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
            \u{1F949} 3rd: ${v} - ${O} pts${E?" \u2190 You":""}
        </div>`,a+=`<div style="margin-top: 10px; color: #00ff88; font-size: 12px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,255,0,0.1); border-radius: 4px;">
            Total Players: ${t.scores?t.scores.length:"No Data"}
        </div>`,this.log(this.LOG_LEVEL.DEBUG,"\u{1F3C6} Player ID comparisons:",{currentPlayerId:n,player1Id:s,player2Id:p,player3Id:I,isPlayer1Current:u,isPlayer2Current:m,isPlayer3Current:E}),o.innerHTML=a,this.log(this.LOG_LEVEL.INFO,"\u2705 Leaderboard updated with real data")}updateUIWithRealTimeData(t,e,o,r){console.log("\u{1F680} Updating UI with real-time data:",t);const n=document.getElementById("game-over-wrapper");if(!n){console.error("\u274C CRITICAL: game-over-wrapper overlay not found!");return}if(console.log("\u2705 Found game-over-wrapper overlay, updating leaderboard..."),t.leaderboard){console.log("\u{1F3C6} TOP 3 DATA FOR OVERLAY:",t.leaderboard.top3),console.log("\u{1F3C6} POPULATING OVERLAY WITH:",t.leaderboard);let a=t.leaderboard.top3,i=t.leaderboard.totalPlayers;!a&&t.leaderboard.scores&&(console.log("\u{1F504} Using fallback: leaderboard.scores instead of top3"),a=t.leaderboard.scores.slice(0,3),i=t.leaderboard.scores.length),(!a||a.length===0)&&(console.log("\u{1F504} Creating mock leaderboard data for testing"),a=[{name:"Player 1",score:1e3,id:"player1"},{name:"Player 2",score:800,id:"player2"},{name:"Player 3",score:600,id:"player3"}],i=3),this.updateOverlayLeaderboard({top3:a,playerRank:t.scoreSubmission?.newRank||"Unknown",totalPlayers:i,freshness:t.metadata?.dataFreshness||"real-time",responseTime:t.metadata?.responseTime||"unknown",scope:t.metadata?.scope||"global",region:t.metadata?.region||"global"})}else console.error("\u274C CRITICAL: No leaderboard data in API response!");if(t.playerAccess){const a=n.querySelector("#playAgainBtn");a&&this.updatePlayAgainButtonWithRealTimeData(a,t.playerAccess)}t.playerStats&&this.updatePlayerStatsDisplay(t.playerStats),this.showPerformanceMetrics(t.metadata),console.log("\u2705 UI updated with real-time data")}updateOverlayLeaderboard({top3:t,playerRank:e,totalPlayers:o,freshness:r,responseTime:n,scope:a,region:i}){console.log("\u{1F3C6} updateOverlayLeaderboard called with:",{top3:t,playerRank:e,totalPlayers:o,freshness:r,responseTime:n,scope:a,region:i});const d=document.getElementById("game-over-wrapper");if(!d){console.error("\u274C CRITICAL: game-over-wrapper not found in updateOverlayLeaderboard");return}console.log("\u2705 Found overlay, looking for leaderboardContent...");const c=d.querySelector("#leaderboardContent");if(c){console.log("\u2705 Found leaderboardContent, updating with top3:",t);let f="";t&&t.length>0?t.forEach((y,l)=>{const x=l===0?"\u{1F947}":l===1?"\u{1F948}":"\u{1F949}",w=y.player_id===this.getPlayerId()||y.id===this.getPlayerId(),p=w?"#00ff88":"#ffffff",m=w?"bold":"normal",g=w?" \u2190 You":"";f+=`
                        <div style="
                            display: flex !important;
                            justify-content: space-between !important;
                            margin-bottom: 8px !important;
                            font-size: 14px !important;
                            color: ${p} !important;
                            font-weight: ${m} !important;
                            font-family: 'Bungee', monospace !important;
                        ">
                            <span>${x} ${l+1}st: ${y.display_name||y.name||"Unknown"} - ${(y.score||0).toLocaleString()} pts${g}</span>
                        </div>
                    `}):f=`
                    <div style="color: #888; font-size: 12px;">
                        No leaderboard data available
                    </div>
                `,e&&o&&(f+=`
                    <div style="
                        margin-top: 10px !important;
                        padding: 8px !important;
                        background: rgba(0, 255, 0, 0.1) !important;
                        border: 1px solid #00ff88 !important;
                        border-radius: 4px !important;
                        font-size: 12px !important;
                        color: #00ff88 !important;
                    ">
                        <strong>Your Rank:</strong> #${e} of ${o.toLocaleString()}
                    </div>
                `),console.log("\u{1F3C6} Generated leaderboard HTML:",f),c.innerHTML=f,console.log("\u2705 Leaderboard HTML updated in DOM")}else console.error("\u274C CRITICAL: leaderboardContent element not found!");const s=d.querySelector(".freshness-indicator");if(s){const f=r==="real-time"?"\u26A1":"\u{1F7E2}";s.textContent=`${f} ${r} (${n})`,s.className=`freshness-indicator ${r==="real-time"?"real-time":"cached"}`}const u=d.querySelector(".leaderboard-title");if(u){const f=a==="regional"?` (${i.toUpperCase()})`:"";u.textContent=`\u{1F3C6} Top Players${f}`}console.log(`\u2705 Leaderboard updated: ${t?.length||0} players, rank ${e}/${o}`)}updatePlayAgainButtonWithRealTimeData(t,e){e.canPlayAgain?this.updatePlayAgainButton(t,"enabled","\u{1F3AE} Play Again \u26A1"):this.updatePlayAgainButton(t,"disabled",`\u{1F4B0} ${e.reason} \u274C`)}updatePlayerStatsDisplay(t){const e=document.getElementById("game-over-wrapper");if(!e)return;const o=e.querySelector(".player-stats");o&&t&&(o.innerHTML=`
                <div style="
                    margin-top: 10px !important;
                    padding: 8px !important;
                    background: rgba(0, 212, 255, 0.1) !important;
                    border: 1px solid #00d4ff !important;
                    border-radius: 4px !important;
                    font-size: 12px !important;
                    color: #00d4ff !important;
                ">
                    <strong>Your Stats:</strong><br>
                    Games Played: ${t.gamesPlayed}<br>
                    Best Score: ${t.bestScore.toLocaleString()}<br>
                    Total Play Time: ${Math.floor(t.totalPlayTime/60)}m ${t.totalPlayTime%60}s
                </div>
            `)}showPerformanceMetrics(t){if(!t)return;console.log("\u26A1 Performance Metrics:"),console.log(`  - Response Time: ${t.responseTime}`),console.log(`  - Data Freshness: ${t.dataFreshness}`),console.log(`  - Scope: ${t.scope}`),console.log(`  - Region: ${t.region}`),console.log(`  - Timestamp: ${t.timestamp}`);const e=document.getElementById("game-over-wrapper");if(e){const o=e.querySelector(".performance-indicator");o&&(o.textContent=`\u26A1 ${t.responseTime} | ${t.dataFreshness}`)}}getPlayerRegion(){if(window.gameWrapper?.identityManager?.getPlayerRegion)return window.gameWrapper.identityManager.getPlayerRegion();try{return navigator.language.split("-")[1]?.toLowerCase()||"global"}catch{return"global"}}getGameData(){const t={gameType:"neon_drop",timestamp:Date.now(),version:"1.0.0"};return window.neonDrop&&(t.seed=window.neonDrop.dailySeed,t.seedDate=window.neonDrop.seedDate),window.neonDrop?.engine?.getPlayTime&&(t.playTime=window.neonDrop.engine.getPlayTime()),t}async updateGameOverUIWithFreshData(t,e,o){throw console.log("\u{1F504} Updating UI with fresh data from email capture"),console.error("\u274C GAME OVER API FAILED - NO FALLBACK"),new Error("Must fix /api/game-over endpoint")}showLoadingStates(t){const e=t.querySelector("#leaderboardContent");e&&(e.innerHTML=`
                <div style="color: #888; font-size: 12px;">
                    \u{1F504} Loading leaderboard...
                </div>
            `);const o=t.querySelector("#playAgainBtn");o&&(o.textContent="\u{1F504} Loading...",o.disabled=!0)}updateDataFreshnessIndicators(t,e,o="all"){if(console.log(`\u{1F504} Updating freshness indicators: ${e} - ${{"\u26A1":"Just fetched","\u{1F7E2}":"Cached (recent)","\u{1F7E1}":"Cached (older)","\u274C":"Network issue"}[e]}`),o==="all"||o==="leaderboard"){const n=t.querySelector(".leaderboard-title");n&&(n.textContent=`\u{1F3C6} Leaderboard ${e}`)}if(o==="all"||o==="access"){const n=t.querySelector("#playAgainBtn");n&&!n.disabled&&(n.textContent=`\u{1F3AE} Play Again ${e}`)}}async showGameOverScreen(t,e,o=!1,r,n){if(console.log("\u{1F3AE} Showing game over screen (legacy), skipSubmission:",o),this.showWrapperInterface(t,e,r,n),o)console.log("\u2705 Score submission skipped (already submitted)");else try{const a=await this.submitScore(t,r,n);throw console.log("\u2705 Combined API response received, updating UI with data"),console.error("\u274C GAME OVER API FAILED - NO FALLBACK"),new Error("Must fix /api/game-over endpoint")}catch{throw console.error("\u274C GAME OVER API FAILED - NO FALLBACK"),new Error("Must fix /api/game-over endpoint")}}async submitScore(t,e,o){throw console.error("\u274C GAME OVER API FAILED - NO FALLBACK"),new Error("Must fix /api/game-over endpoint")}showWrapperInterface(t,e,o,r){console.log("\u{1F3AE} showWrapperInterface() called with:",{score:t,metrics:e,playerName:o,playerID:r}),this.overlayPerformance={startTime:Date.now(),markInstantDisplay(){console.log(`\u26A1 Overlay displayed instantly: ${Date.now()-this.startTime}ms`)},markDataLoaded(l){const x=Date.now()-this.startTime;console.log(`\u2705 Overlay fully loaded: ${x}ms (API: ${l})`)}};const n=document.getElementById("game-over-wrapper");n&&(console.log("\u{1F3AE} Removing existing game-over-wrapper overlay"),n.remove());const a=document.createElement("div");a.id="game-over-wrapper",a.className="game-over-overlay",a.style.cssText=`
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 9999999 !important;
            animation: fadeIn 0.8s ease-out !important;
            font-family: 'Bungee', monospace !important;
            padding: 40px !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
        `,a.innerHTML=`
            <style>
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes slideUp { 
                    0% { transform: translateY(50px); opacity: 0; }
                    100% { transform: translateY(0); opacity: 1; }
                }
                @keyframes scorePulse { 
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.02); }
                }
                @keyframes floatUp { 
                    0% { transform: translateY(20px); opacity: 0; }
                    100% { transform: translateY(0); opacity: 1; }
                }
                .game-over-card { animation: slideUp 0.6s ease-out; }
                .score-display { animation: scorePulse 3s ease-in-out infinite; }
                .info-line { animation: floatUp 0.6s ease-out forwards; }
                .info-line:nth-child(1) { animation-delay: 0.1s; }
                .info-line:nth-child(2) { animation-delay: 0.2s; }
                .info-line:nth-child(3) { animation-delay: 0.3s; }
                .info-line:nth-child(4) { animation-delay: 0.4s; }
                .info-line:nth-child(5) { animation-delay: 0.5s; }
                .info-line:nth-child(6) { animation-delay: 0.6s; }
                
                /* Responsive design for smaller screens */
                @media (max-height: 600px) {
                    .game-over-card {
                        max-height: 90vh !important;
                        padding: 20px !important;
                    }
                }
                
                @media (max-width: 480px) {
                    .game-over-card {
                        width: 90% !important;
                        padding: 20px !important;
                    }
                }
                
                /* Freshness indicator styles */
                .freshness-indicator {
                    font-size: 0.8em !important;
                    color: #666 !important;
                    margin-left: 10px !important;
                    font-family: 'Bungee', monospace !important;
                }
                
                .freshness-indicator.real-time {
                    color: #00ff00 !important;
                    text-shadow: 0 0 5px #00ff00 !important;
                }
                
                .freshness-indicator.cached {
                    color: #ffaa00 !important;
                    text-shadow: 0 0 5px #ffaa00 !important;
                }
                
                .leaderboard-entry.current-player {
                    background: rgba(0, 255, 0, 0.1) !important;
                    border: 1px solid #00ff00 !important;
                    border-radius: 4px !important;
                }
                
                .loading-placeholder {
                    text-align: center !important;
                    color: #999 !important;
                    padding: 20px !important;
                    font-family: 'Bungee', monospace !important;
                }
                
                .performance-indicator {
                    position: absolute !important;
                    top: 10px !important;
                    right: 10px !important;
                    font-size: 10px !important;
                    color: #00d4ff !important;
                    opacity: 0.7 !important;
                    font-family: 'Bungee', monospace !important;
                }
            </style>
            
            <!-- NEW STREAMLINED GAME OVER CARD -->
            <div class="game-over-card" style="
                background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%) !important;
                border: 3px solid #00d4ff !important;
                border-radius: 25px !important;
                padding: 25px !important;
                max-width: 600px !important;
                width: 85% !important;
                max-height: 80vh !important;
                text-align: center !important;
                box-shadow: 0 0 40px rgba(0, 212, 255, 0.4), inset 0 0 20px rgba(0, 212, 255, 0.1) !important;
                position: relative !important;
                overflow: hidden !important;
                margin: auto !important;
                backdrop-filter: blur(10px) !important;
            ">
                <!-- NEON DROP Header -->
                <div style="margin-bottom: 15px;">
                    <div style="
                        font-size: 28px !important;
                        font-weight: bold !important;
                        color: #00d4ff !important;
                        margin-bottom: 5px !important;
                        text-shadow: 0 0 15px #00d4ff !important;
                        font-family: 'Bungee', monospace !important;
                        letter-spacing: 2px !important;
                    ">NEON DROP</div>
                    
                    <div style="
                        font-size: 12px !important;
                        color: #888888 !important;
                        font-family: 'Bungee', monospace !important;
                    ">Tournament Challenge</div>
                </div>
                
                <!-- Score Display -->
                <div style="
                    font-size: 36px !important;
                    font-weight: bold !important;
                    color: #00d4ff !important;
                    margin-bottom: 10px !important;
                    text-shadow: 0 0 15px #00d4ff !important;
                    font-family: 'Bungee', monospace !important;
                " class="score-display">${t.toLocaleString()}</div>
                
                <!-- Player Info -->
                <div style="margin-bottom: 15px;">
                    <div style="
                        font-size: 14px !important;
                        color: #ffffff !important;
                        margin-bottom: 3px !important;
                        font-family: 'Bungee', monospace !important;
                    " class="info-line">\u{1F464} ${o}</div>
                </div>
                
                <!-- INTEGRATED LEADERBOARD SECTION -->
                <div id="leaderboardSection" style="
                    background: rgba(0, 212, 255, 0.1) !important;
                    border: 1px solid #00d4ff !important;
                    border-radius: 12px !important;
                    padding: 12px !important;
                    margin-bottom: 12px !important;
                    position: relative !important;
                ">
                    <!-- Performance indicator -->
                    <div class="performance-indicator">\u26A1 Loading...</div>
                    
                    <div style="
                        font-size: 18px !important;
                        color: #00d4ff !important;
                        margin-bottom: 15px !important;
                        font-weight: bold !important;
                        font-family: 'Bungee', monospace !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                    ">
                        \u{1F3C6} LEADERBOARD
                        <span class="freshness-indicator">\u{1F504} Loading...</span>
                    </div>
                    
                    <div id="leaderboardContent" style="
                        font-size: 14px !important;
                        color: #ffffff !important;
                        font-family: 'Bungee', monospace !important;
                        text-align: center !important;
                    ">
                        <div style="color: #ffffff; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            \u{1F947} 1st: No Data - No Data pts
                        </div>
                        <div style="color: #ffffff; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            \u{1F948} 2nd: No Data - No Data pts
                        </div>
                        <div style="color: #ffffff; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            \u{1F949} 3rd: No Data - No Data pts
                        </div>
                        <div style="margin-top: 10px; color: #00ff88; font-size: 12px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,255,0,0.1); border-radius: 4px;">
                            Total Players: No Data
                        </div>
                    </div>
                    
                    <button id="viewLeaderboardBtn" style="
                        background: none !important;
                        color: #00d4ff !important;
                        border: 1px solid #00d4ff !important;
                        padding: 8px 16px !important;
                        border-radius: 8px !important;
                        font-size: 12px !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                        margin-top: 10px !important;
                    "
                    onmouseover="this.style.backgroundColor='rgba(0, 212, 255, 0.1)'"
                    onmouseout="this.style.backgroundColor='transparent'"
                    class="info-line">
                        View Full Leaderboard
                    </button>
                </div>
                
                <!-- CHALLENGE FRIENDS SECTION -->
                <div style="
                    background: rgba(0, 255, 136, 0.1) !important;
                    border: 1px solid #00ff88 !important;
                    border-radius: 12px !important;
                    padding: 12px !important;
                    margin-bottom: 15px !important;
                ">
                    <div style="
                        font-size: 18px !important;
                        color: #00ff88 !important;
                        margin-bottom: 15px !important;
                        font-weight: bold !important;
                        font-family: 'Bungee', monospace !important;
                    ">\u26A1 CHALLENGE FRIENDS</div>
                    
                    <div style="
                        font-size: 14px !important;
                        color: #ffffff !important;
                        margin-bottom: 15px !important;
                        font-family: 'Bungee', monospace !important;
                    ">Save this game and challenge others!</div>
                    
                    <div style="
                        display: flex !important;
                        justify-content: space-around !important;
                        margin-bottom: 15px !important;
                        flex-wrap: wrap !important;
                        gap: 10px !important;
                    ">
                        <button id="challenge2Btn" style="
                            background: rgba(0, 255, 136, 0.2) !important;
                            border: 2px solid #00ff88 !important;
                            border-radius: 8px !important;
                            padding: 12px !important;
                            text-align: center !important;
                            cursor: pointer !important;
                            transition: all 0.3s ease !important;
                            min-width: 120px !important;
                        "
                        onmouseover="this.style.background='rgba(0, 255, 136, 0.3)'; this.style.transform='scale(1.05)'"
                        onmouseout="this.style.background='rgba(0, 255, 136, 0.2)'; this.style.transform='scale(1)'"
                        class="info-line">
                            <div style="
                                font-size: 16px !important;
                                color: #00ff88 !important;
                                font-weight: bold !important;
                                font-family: 'Bungee', monospace !important;
                            ">\u{1F4B0} $2 Challenge</div>
                            <div style="
                                font-size: 12px !important;
                                color: #ffffff !important;
                                font-family: 'Bungee', monospace !important;
                            ">Winner gets $3.60</div>
                        </button>
                        
                        <button id="challenge5Btn" style="
                            background: rgba(0, 255, 136, 0.2) !important;
                            border: 2px solid #00ff88 !important;
                            border-radius: 8px !important;
                            padding: 12px !important;
                            text-align: center !important;
                            cursor: pointer !important;
                            transition: all 0.3s ease !important;
                            min-width: 120px !important;
                        "
                        onmouseover="this.style.background='rgba(0, 255, 136, 0.3)'; this.style.transform='scale(1.05)'"
                        onmouseout="this.style.background='rgba(0, 255, 136, 0.2)'; this.style.transform='scale(1)'"
                        class="info-line">
                            <div style="
                                font-size: 16px !important;
                                color: #00ff88 !important;
                                font-weight: bold !important;
                                font-family: 'Bungee', monospace !important;
                            ">\u{1F48E} $5 Challenge</div>
                            <div style="
                                font-size: 12px !important;
                                color: #ffffff !important;
                                font-family: 'Bungee', monospace !important;
                            ">Winner gets $9.00</div>
                        </button>
                    </div>
                    
                    <div style="
                        display: flex !important;
                        gap: 10px !important;
                        justify-content: center !important;
                        flex-wrap: wrap !important;
                    ">
                        <button id="shareScoreBtn" style="
                            background: none !important;
                            color: #00ff88 !important;
                            border: 1px solid #00ff88 !important;
                            padding: 10px 16px !important;
                            border-radius: 8px !important;
                            font-size: 12px !important;
                            cursor: pointer !important;
                            transition: all 0.3s ease !important;
                            font-family: 'Bungee', monospace !important;
                        "
                        onmouseover="this.style.backgroundColor='rgba(0, 255, 136, 0.1)'"
                        onmouseout="this.style.backgroundColor='transparent'"
                        class="info-line">
                            Share Score
                        </button>
                    </div>
                </div>
                
                <!-- PRIMARY ACTION BUTTONS -->
                <div style="
                    display: flex !important;
                    gap: 10px !important;
                    justify-content: center !important;
                    margin-bottom: 12px !important;
                    flex-wrap: wrap !important;
                ">
                    <button id="playAgainBtn" style="
                        background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%) !important;
                        color: #000000 !important;
                        border: none !important;
                        padding: 10px 20px !important;
                        border-radius: 8px !important;
                        font-size: 13px !important;
                        font-weight: bold !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                        box-shadow: 0 0 20px rgba(0, 212, 255, 0.4) !important;
                        min-width: 120px !important;
                    "
                    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 30px rgba(0, 212, 255, 0.6)'"
                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 20px rgba(0, 212, 255, 0.4)'"
                    class="info-line">
                        \u{1F504} PLAY AGAIN
                    </button>
                    
                    <button id="gamesBtn" style="
                        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
                        color: #ffffff !important;
                        border: none !important;
                        padding: 10px 20px !important;
                        border-radius: 8px !important;
                        font-size: 13px !important;
                        font-weight: bold !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                        box-shadow: 0 0 20px rgba(255, 107, 107, 0.4) !important;
                        min-width: 120px !important;
                    "
                    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 30px rgba(255, 107, 107, 0.6)'"
                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 20px rgba(255, 107, 107, 0.4)'"
                    class="info-line">
                        \u{1F3AE} GAMES
                    </button>
                    
                    <button id="homeBtn" style="
                        background: none !important;
                        color: #ffaa00 !important;
                        border: 2px solid #ffaa00 !important;
                        padding: 10px 20px !important;
                        border-radius: 8px !important;
                        font-size: 13px !important;
                        font-weight: bold !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                        text-shadow: 0 0 10px #ffaa00 !important;
                        box-shadow: 0 0 15px rgba(255, 170, 0, 0.3) !important;
                        min-width: 120px !important;
                    "
                    onmouseover="this.style.backgroundColor='rgba(255, 170, 0, 0.1)'; this.style.boxShadow='0 0 25px rgba(255, 170, 0, 0.5)'"
                    onmouseout="this.style.backgroundColor='transparent'; this.style.boxShadow='0 0 15px rgba(255, 170, 0, 0.3)'"
                    class="info-line">
                        \u{1F3E0} HOME
                    </button>
                </div>
            </div>
        `;try{document.body.appendChild(a),this.log(this.LOG_LEVEL.INFO,"\u2705 Overlay successfully added to document.body")}catch(l){this.log(this.LOG_LEVEL.ERROR,"\u274C Error adding overlay to DOM:",l)}console.log("\u{1F50D} Setting up button handlers for streamlined design...");const i=a.querySelector("#playAgainBtn");i?(console.log("\u{1F3AE} Setting up Play Again button - will be updated with API data"),i.addEventListener("click",async l=>{if(console.log("\u{1F3AE} Play Again button clicked"),l.stopPropagation(),i.disabled){console.log("\u{1F3AF} Play Again button is disabled - ignoring click");return}this.leaderboardInstance&&this.leaderboardInstance.isVisible&&(console.log("\u{1F3AE} Hiding leaderboard instance"),this.leaderboardInstance.hide()),this.hide(),console.log("\u{1F3AE} Play Again clicked - starting new game"),this.eventBus.emit("startGame")})):console.error("\u274C Play Again button not found!");const d=a.querySelector("#homeBtn");d&&d.addEventListener("click",()=>{console.log("\u{1F3E0} Home button clicked"),this.hide(),window.location.href="/"});const c=a.querySelector("#viewLeaderboardBtn");c&&(console.log("\u{1F3C6} Setting up Leaderboard button listener"),c.addEventListener("click",l=>{console.log("\u{1F3C6} Leaderboard button clicked - showing leaderboard"),l.stopPropagation(),this.showStyledLeaderboard()}));const s=a.querySelector("#challenge2Btn");s&&s.addEventListener("click",l=>{console.log("\u{1F4B0} $2 Challenge button clicked"),l.stopPropagation(),this.createChallenge(t,2)});const u=a.querySelector("#challenge5Btn");u&&u.addEventListener("click",l=>{console.log("\u{1F48E} $5 Challenge button clicked"),l.stopPropagation(),this.createChallenge(t,5)});const f=a.querySelector("#shareScoreBtn");f&&f.addEventListener("click",l=>{console.log("\u{1F4E4} Share Score button clicked"),l.stopPropagation(),this.shareScore(t)});const y=a.querySelector("#gamesBtn");y&&y.addEventListener("click",l=>{console.log("\u{1F3AE} Games button clicked"),l.stopPropagation(),this.hide(),window.location.href="/games/"})}showChallengeCreation(t){console.log("\u26A1 Showing challenge creation for score:",t);const e=document.createElement("div");e.id="challenge-modal",e.style.cssText=`
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.8) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 9999999 !important;
            font-family: 'Bungee', monospace !important;
        `,e.innerHTML=`
            <div style="
                background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%) !important;
                border: 2px solid #00ff88 !important;
                border-radius: 20px !important;
                padding: 30px !important;
                max-width: 500px !important;
                width: 90% !important;
                text-align: center !important;
                box-shadow: 0 0 30px rgba(0, 255, 136, 0.3) !important;
            ">
                <div style="
                    font-size: 24px !important;
                    color: #00ff88 !important;
                    margin-bottom: 20px !important;
                    font-weight: bold !important;
                ">\u26A1 CREATE CHALLENGE</div>
                
                <div style="
                    font-size: 16px !important;
                    color: #ffffff !important;
                    margin-bottom: 20px !important;
                ">Challenge others with your score of <span style="color: #00ff88; font-weight: bold;">${t.toLocaleString()}</span></div>
                
                <div style="
                    display: flex !important;
                    gap: 15px !important;
                    justify-content: center !important;
                    margin-bottom: 20px !important;
                    flex-wrap: wrap !important;
                ">
                    <button id="challenge2Btn" style="
                        background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%) !important;
                        color: #000000 !important;
                        border: none !important;
                        padding: 15px 20px !important;
                        border-radius: 10px !important;
                        font-size: 14px !important;
                        font-weight: bold !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                    "
                    onmouseover="this.style.transform='scale(1.05)'"
                    onmouseout="this.style.transform='scale(1)'">
                        \u{1F4B0} $2 Challenge<br><span style="font-size: 12px;">Winner gets $3.60</span>
                    </button>
                    
                    <button id="challenge5Btn" style="
                        background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%) !important;
                        color: #000000 !important;
                        border: none !important;
                        padding: 15px 20px !important;
                        border-radius: 10px !important;
                        font-size: 14px !important;
                        font-weight: bold !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                    "
                    onmouseover="this.style.transform='scale(1.05)'"
                    onmouseout="this.style.transform='scale(1)'">
                        \u{1F48E} $5 Challenge<br><span style="font-size: 12px;">Winner gets $9.00</span>
                    </button>
                </div>
                
                <button id="closeChallengeBtn" style="
                    background: none !important;
                    color: #888888 !important;
                    border: 1px solid #555555 !important;
                    padding: 10px 20px !important;
                    border-radius: 8px !important;
                    font-size: 14px !important;
                    cursor: pointer !important;
                    transition: all 0.3s ease !important;
                    font-family: 'Bungee', monospace !important;
                "
                onmouseover="this.style.color='#ffffff'; this.style.borderColor='#888888'"
                onmouseout="this.style.color='#888888'; this.style.borderColor='#555555'">
                    Cancel
                </button>
            </div>
        `,e.querySelector("#challenge2Btn").addEventListener("click",()=>{this.createChallenge(t,2),e.remove()}),e.querySelector("#challenge5Btn").addEventListener("click",()=>{this.createChallenge(t,5),e.remove()}),e.querySelector("#closeChallengeBtn").addEventListener("click",()=>{e.remove()}),document.body.appendChild(e)}createChallenge(t,e){console.log(`\u26A1 Creating $${e} challenge for score:`,t);const o=document.createElement("div");o.style.cssText=`
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%) !important;
            color: #000000 !important;
            padding: 15px 20px !important;
            border-radius: 10px !important;
            font-family: 'Bungee', monospace !important;
            font-weight: bold !important;
            z-index: 9999999 !important;
            animation: slideIn 0.5s ease-out !important;
        `,o.innerHTML=`
            <style>
                @keyframes slideIn { 
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            </style>
            \u2705 $${e} Challenge Created!<br>
            <span style="font-size: 12px;">Share with friends to start competing</span>
        `,document.body.appendChild(o),setTimeout(()=>{o.remove()},3e3)}shareScore(t){console.log("\u{1F4E4} Sharing score:",t);const e=`I just scored ${t.toLocaleString()} points in NeonDrop on BlockZone Lab! \u{1F3AE} Can you beat my score? Play at blockzonelab.com`;navigator.share?navigator.share({title:"My NeonDrop Score",text:e,url:"https://blockzonelab.com"}).catch(o=>{console.log("Share failed:",o),this.fallbackShare(e)}):this.fallbackShare(e)}fallbackShare(t){navigator.clipboard.writeText(t).then(()=>{const e=document.createElement("div");e.style.cssText=`
                position: fixed !important;
                top: 20px !important;
                right: 20px !important;
                background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%) !important;
                color: #000000 !important;
                padding: 15px 20px !important;
                border-radius: 10px !important;
                font-family: 'Bungee', monospace !important;
                font-weight: bold !important;
                z-index: 9999999 !important;
                animation: slideIn 0.5s ease-out !important;
            `,e.innerHTML=`
                <style>
                    @keyframes slideIn { 
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                </style>
                \u{1F4CB} Score copied to clipboard!<br>
                <span style="font-size: 12px;">Paste it anywhere to share</span>
            `,document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)})}getPlayerName(){if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Getting player name from multiple sources..."),window.identityManager&&window.identityManager.getPlayerName){const t=window.identityManager.getPlayerName();if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Got name from identityManager:",t),t&&t!=="Player")return t}if(window.gameWrapper&&window.gameWrapper.getPlayerName){const t=window.gameWrapper.getPlayerName();if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Got name from gameWrapper:",t),t&&t!=="Player")return t}if(this.identitySystem&&this.identitySystem.getPlayerName){const t=this.identitySystem.getPlayerName();if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Got name from this.identitySystem:",t),t&&t!=="Player")return t}try{const t=localStorage.getItem("blockzone_player_data");if(t){const e=JSON.parse(t);if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Got name from localStorage:",e.display_name),e.display_name)return e.display_name}}catch(t){this.log(this.LOG_LEVEL.ERROR,"\u274C Error reading from localStorage:",t)}return this.log(this.LOG_LEVEL.WARN,"\u26A0\uFE0F No player name found, using default"),"Player"}updatePlayAgainButton(t,e,o){e==="enabled"?(t.disabled=!1,t.style.color="#00d4ff",t.style.borderColor="#00d4ff",t.style.cursor="pointer",t.style.opacity="1",t.style.textShadow="0 0 10px #00d4ff",t.style.boxShadow="0 0 15px rgba(0, 212, 255, 0.3)",t.onmouseover=()=>{t.style.backgroundColor="rgba(0, 212, 255, 0.1)",t.style.boxShadow="0 0 25px rgba(0, 212, 255, 0.5)"},t.onmouseout=()=>{t.style.backgroundColor="transparent",t.style.boxShadow="0 0 15px rgba(0, 212, 255, 0.3)"}):(t.disabled=!0,t.style.color="#666666",t.style.borderColor="#666666",t.style.cursor="not-allowed",t.style.opacity="0.5",t.style.textShadow="0 0 10px #666666",t.style.boxShadow="0 0 15px rgba(102, 102, 102, 0.3)",t.onmouseover=null,t.onmouseout=null),t.textContent=o,console.log("\u{1F3AF} Play Again button updated:",{state:e,text:o})}getPlayerId(){if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Getting player ID from multiple sources..."),window.identityManager&&window.identityManager.getPlayerId){const t=window.identityManager.getPlayerId();if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Got ID from identityManager:",t),t&&t!=="unknown")return t}if(window.gameWrapper&&window.gameWrapper.getPlayerId){const t=window.gameWrapper.getPlayerId();if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Got ID from gameWrapper:",t),t&&t!=="unknown")return t}if(this.identitySystem&&this.identitySystem.getPlayerId){const t=this.identitySystem.getPlayerId();if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Got ID from this.identitySystem:",t),t&&t!=="unknown")return t}try{const t=localStorage.getItem("blockzone_player_data");if(t){const e=JSON.parse(t);if(this.log(this.LOG_LEVEL.DEBUG,"\u{1F50D} Got ID from localStorage:",e.player_id),e.player_id)return e.player_id}}catch(t){this.log(this.LOG_LEVEL.ERROR,"\u274C Error reading from localStorage:",t)}return this.log(this.LOG_LEVEL.WARN,"\u26A0\uFE0F No player ID found, using default"),"unknown"}hide(){const t=document.getElementById("game-over-wrapper");t&&t.remove(),this.isVisible=!1}async showStyledLeaderboard(){if(console.log("\u{1F3AF} Attempting to show styled leaderboard..."),this.leaderboardInstance&&this.leaderboardInstance.isVisible){console.log("\u{1F3C6} Leaderboard already visible, hiding first..."),this.leaderboardInstance.hide();return}try{console.log("\u{1F4E6} Importing LeaderboardDisplay component...");const{LeaderboardDisplay:t}=await import("/shared/components/LeaderboardDisplay.js");console.log("\u2705 LeaderboardDisplay imported successfully"),this.leaderboardInstance=new t,console.log("\u{1F3C6} LeaderboardDisplay instance created"),await this.leaderboardInstance.show(),console.log("\u2705 Leaderboard displayed successfully")}catch(t){console.error("\u274C Failed to show styled leaderboard:",t),console.error("\u274C Error details:",t.message,t.stack),this.showLeaderboardError("Failed to load leaderboard component. Please try again.")}}showLeaderboardError(t){console.log("\u{1F3C6} Showing leaderboard error:",t);const e=document.getElementById("leaderboard-error");e&&e.remove();const o=document.createElement("div");o.id="leaderboard-error",o.className="leaderboard-overlay",o.innerHTML=`
            <style>
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes neonGlow { 
                    0%, 100% { text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor; }
                    50% { text-shadow: 0 0 20px currentColor, 0 0 30px currentColor, 0 0 40px currentColor; }
                }
                .leaderboard-overlay {
                    position: fixed !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100vw !important;
                    height: 100vh !important;
                    background: rgba(0, 0, 0, 0.9) !important;
                    display: flex !important;
                    align-items: center !important;
                    justify-content: center !important;
                    z-index: 10000000 !important;
                    animation: fadeIn 0.5s ease-out !important;
                }
                .error-container {
                    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%) !important;
                    border-radius: 20px !important;
                    padding: 40px !important;
                    max-width: 500px !important;
                    width: 90% !important;
                    text-align: center !important;
                    box-shadow: 0 20px 60px rgba(255, 68, 68, 0.3), 0 0 40px rgba(255, 68, 68, 0.1) !important;
                    border: 1px solid rgba(255, 68, 68, 0.2) !important;
                    color: white !important;
                    font-family: 'Bungee', monospace !important;
                }
                .error-icon {
                    font-size: 48px !important;
                    margin-bottom: 20px !important;
                }
                .error-title {
                    font-size: 24px !important;
                    font-weight: bold !important;
                    color: #ff4444 !important;
                    margin-bottom: 15px !important;
                    animation: neonGlow 2s ease-in-out infinite !important;
                }
                .error-message {
                    font-size: 16px !important;
                    color: #cccccc !important;
                    margin-bottom: 25px !important;
                    line-height: 1.5 !important;
                }
                .action-btn {
                    padding: 12px 24px !important;
                    border: none !important;
                    border-radius: 8px !important;
                    font-family: 'Bungee', monospace !important;
                    font-weight: 600 !important;
                    font-size: 14px !important;
                    cursor: pointer !important;
                    transition: all 0.3s ease !important;
                    min-width: 120px !important;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
                }
                .action-btn.secondary {
                    background: linear-gradient(45deg, #666, #444) !important;
                    color: #fff !important;
                    border: 2px solid #666 !important;
                }
                .action-btn.secondary:hover {
                    background: linear-gradient(45deg, #777, #555) !important;
                    transform: translateY(-2px) !important;
                    box-shadow: 0 8px 25px rgba(136, 136, 136, 0.4) !important;
                }
            </style>
            
            <div class="error-container">
                <div class="error-icon">\u26A0\uFE0F</div>
                <div class="error-title">Leaderboard Error</div>
                <div class="error-message">${t}</div>
                <button id="closeErrorBtn" class="action-btn secondary">Close</button>
            </div>
        `,document.body.appendChild(o),document.getElementById("closeErrorBtn").addEventListener("click",()=>{o.remove()}),o.addEventListener("click",r=>{r.target===o&&o.remove()})}async getIdentityDataOnce(){const t=Date.now();if(this.identityCache&&t-this.cacheTimestamp<this.CACHE_DURATION)return this.log(this.LOG_LEVEL.DEBUG,"\u{1F680} Using cached identity data (0ms lookup time)"),this.identityCache;this.log(this.LOG_LEVEL.INFO,"\u{1F504} Fetching identity data once for entire game-over sequence...");const[e,o]=await Promise.all([this.getPlayerName(),this.getPlayerId()]);return this.identityCache={playerName:e,playerID:o},this.cacheTimestamp=t,this.log(this.LOG_LEVEL.INFO,"\u2705 Identity data cached - all subsequent calls will be instant"),this.identityCache}createOverlayWithHardcodedMedals(t){this.log(this.LOG_LEVEL.INFO,"\u26A1 INSTANT: Creating overlay with hard-coded medal positions"),this.getLeaderboardForOverlay(t)&&this.log(this.LOG_LEVEL.INFO,"\u{1F4CA} Found cached leaderboard data, will use real data instead of hard-coded");const o=document.getElementById("game-over-wrapper");o&&(this.log(this.LOG_LEVEL.INFO,"\u{1F3AE} Removing existing game-over-wrapper overlay"),o.remove());const r=document.createElement("div");r.id="game-over-wrapper",r.className="game-over-overlay",r.style.cssText=`
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            z-index: 9999999 !important;
            animation: fadeIn 0.8s ease-out !important;
            font-family: 'Bungee', monospace !important;
            padding: 40px !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
        `,r.innerHTML=`
            <style>
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes slideUp { 
                    0% { transform: translateY(50px); opacity: 0; }
                    100% { transform: translateY(0); opacity: 1; }
                }
                @keyframes scorePulse { 
                    0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.02); }
                }
                @keyframes floatUp { 
                    0% { transform: translateY(20px); opacity: 0; }
                    100% { transform: translateY(0); opacity: 1; }
                }
                .game-over-card { animation: slideUp 0.6s ease-out; }
                .score-display { animation: scorePulse 3s ease-in-out infinite; }
                .info-line { animation: floatUp 0.6s ease-out forwards; }
                .info-line:nth-child(1) { animation-delay: 0.1s; }
                .info-line:nth-child(2) { animation-delay: 0.2s; }
                .info-line:nth-child(3) { animation-delay: 0.3s; }
                .info-line:nth-child(4) { animation-delay: 0.4s; }
                .info-line:nth-child(5) { animation-delay: 0.5s; }
                .info-line:nth-child(6) { animation-delay: 0.6s; }
                
                /* Responsive design for smaller screens */
                @media (max-height: 600px) {
                    .game-over-card {
                        max-height: 90vh !important;
                        padding: 20px !important;
                    }
                }
                
                @media (max-width: 480px) {
                    .game-over-card {
                        width: 90% !important;
                        padding: 20px !important;
                    }
                }
                
                /* Freshness indicator styles */
                .freshness-indicator {
                    font-size: 0.8em !important;
                    color: #666 !important;
                    margin-left: 10px !important;
                    font-family: 'Bungee', monospace !important;
                }
                
                .freshness-indicator.real-time {
                    color: #00ff00 !important;
                    text-shadow: 0 0 5px #00ff00 !important;
                }
                
                .freshness-indicator.cached {
                    color: #ffaa00 !important;
                    text-shadow: 0 0 5px #ffaa00 !important;
                }
                
                .leaderboard-entry.current-player {
                    background: rgba(0, 255, 0, 0.1) !important;
                    border: 1px solid #00ff00 !important;
                    border-radius: 4px !important;
                }
                
                .loading-placeholder {
                    text-align: center !important;
                    color: #999 !important;
                    padding: 20px !important;
                    font-family: 'Bungee', monospace !important;
                }
                
                .performance-indicator {
                    position: absolute !important;
                    top: 10px !important;
                    right: 10px !important;
                    font-size: 10px !important;
                    color: #00d4ff !important;
                    opacity: 0.7 !important;
                    font-family: 'Bungee', monospace !important;
                }
            </style>
            
            <!-- NEW STREAMLINED GAME OVER CARD -->
            <div class="game-over-card" style="
                background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%) !important;
                border: 3px solid #00d4ff !important;
                border-radius: 25px !important;
                padding: 25px !important;
                max-width: 600px !important;
                width: 85% !important;
                max-height: 80vh !important;
                text-align: center !important;
                box-shadow: 0 0 40px rgba(0, 212, 255, 0.4), inset 0 0 20px rgba(0, 212, 255, 0.1) !important;
                position: relative !important;
                overflow: hidden !important;
                margin: auto !important;
                backdrop-filter: blur(10px) !important;
            ">
                <!-- NEON DROP Header -->
                <div style="margin-bottom: 15px;">
                    <div style="
                        font-size: 28px !important;
                        font-weight: bold !important;
                        color: #00d4ff !important;
                        margin-bottom: 5px !important;
                        text-shadow: 0 0 15px #00d4ff !important;
                        font-family: 'Bungee', monospace !important;
                        letter-spacing: 2px !important;
                    ">NEON DROP</div>
                    
                    <div style="
                        font-size: 12px !important;
                        color: #888888 !important;
                        font-family: 'Bungee', monospace !important;
                    ">Tournament Challenge</div>
                </div>
                
                <!-- Score Display -->
                <div style="
                    font-size: 36px !important;
                    font-weight: bold !important;
                    color: #00d4ff !important;
                    margin-bottom: 10px !important;
                    text-shadow: 0 0 15px #00d4ff !important;
                    font-family: 'Bungee', monospace !important;
                " class="score-display">${t.toLocaleString()}</div>
                
                <!-- Player Info (will be updated) -->
                <div id="playerInfoSection" style="margin-bottom: 15px;">
                    <div style="
                        font-size: 14px !important;
                        color: #ffffff !important;
                        margin-bottom: 3px !important;
                        font-family: 'Bungee', monospace !important;
                    " class="info-line">\u{1F464} Loading player...</div>
                </div>
                
                <!-- INTEGRATED LEADERBOARD SECTION -->
                <div id="leaderboardSection" style="
                    background: rgba(0, 212, 255, 0.1) !important;
                    border: 1px solid #00d4ff !important;
                    border-radius: 12px !important;
                    padding: 12px !important;
                    margin-bottom: 12px !important;
                    position: relative !important;
                ">
                    <!-- Performance indicator -->
                    <div class="performance-indicator">\u26A1 Loading...</div>
                    
                    <div style="
                        font-size: 18px !important;
                        color: #00d4ff !important;
                        margin-bottom: 15px !important;
                        font-weight: bold !important;
                        font-family: 'Bungee', monospace !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                    ">
                        \u{1F3C6} LEADERBOARD
                        <span class="freshness-indicator">\u{1F504} Loading...</span>
                    </div>
                    
                    <div id="leaderboardContent" style="
                        font-size: 14px !important;
                        color: #ffffff !important;
                        font-family: 'Bungee', monospace !important;
                        text-align: center !important;
                    ">
                        <div style="color: #ffffff; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            \u{1F947} 1st: No Data - No Data pts
                        </div>
                        <div style="color: #ffffff; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            \u{1F948} 2nd: No Data - No Data pts
                        </div>
                        <div style="color: #ffffff; margin-bottom: 8px; font-size: 14px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,0,0,0.3); border-radius: 4px;">
                            \u{1F949} 3rd: No Data - No Data pts
                        </div>
                        <div style="margin-top: 10px; color: #00ff88; font-size: 12px; font-weight: bold; text-align: center; padding: 4px; background: rgba(0,255,0,0.1); border-radius: 4px;">
                            Total Players: No Data
                        </div>
                    </div>
                    
                    <button id="viewLeaderboardBtn" style="
                        background: none !important;
                        color: #00d4ff !important;
                        border: 1px solid #00d4ff !important;
                        padding: 8px 16px !important;
                        border-radius: 8px !important;
                        font-size: 12px !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                        margin-top: 10px !important;
                    "
                    onmouseover="this.style.backgroundColor='rgba(0, 212, 255, 0.1)'"
                    onmouseout="this.style.backgroundColor='transparent'"
                    class="info-line">
                        View Full Leaderboard
                    </button>
                </div>
                
                <!-- CHALLENGE FRIENDS SECTION -->
                <div style="
                    background: rgba(0, 255, 136, 0.1) !important;
                    border: 1px solid #00ff88 !important;
                    border-radius: 12px !important;
                    padding: 12px !important;
                    margin-bottom: 15px !important;
                ">
                    <div style="
                        font-size: 18px !important;
                        color: #00ff88 !important;
                        margin-bottom: 15px !important;
                        font-weight: bold !important;
                        font-family: 'Bungee', monospace !important;
                    ">\u26A1 CHALLENGE FRIENDS</div>
                    
                    <div style="
                        font-size: 14px !important;
                        color: #ffffff !important;
                        margin-bottom: 15px !important;
                        font-family: 'Bungee', monospace !important;
                    ">Save this game and challenge others!</div>
                    
                    <div style="
                        display: flex !important;
                        justify-content: space-around !important;
                        margin-bottom: 15px !important;
                        flex-wrap: wrap !important;
                        gap: 10px !important;
                    ">
                        <button id="challenge2Btn" style="
                            background: rgba(0, 255, 136, 0.2) !important;
                            border: 2px solid #00ff88 !important;
                            border-radius: 8px !important;
                            padding: 12px !important;
                            text-align: center !important;
                            cursor: pointer !important;
                            transition: all 0.3s ease !important;
                            min-width: 120px !important;
                        "
                        onmouseover="this.style.background='rgba(0, 255, 136, 0.3)'; this.style.transform='scale(1.05)'"
                        onmouseout="this.style.background='rgba(0, 255, 136, 0.2)'; this.style.transform='scale(1)'"
                        class="info-line">
                            <div style="
                                font-size: 16px !important;
                                color: #00ff88 !important;
                                font-weight: bold !important;
                                font-family: 'Bungee', monospace !important;
                            ">\u{1F4B0} $2 Challenge</div>
                            <div style="
                                font-size: 12px !important;
                                color: #ffffff !important;
                                font-family: 'Bungee', monospace !important;
                            ">Winner gets $3.60</div>
                        </button>
                        
                        <button id="challenge5Btn" style="
                            background: rgba(0, 255, 136, 0.2) !important;
                            border: 2px solid #00ff88 !important;
                            border-radius: 8px !important;
                            padding: 12px !important;
                            text-align: center !important;
                            cursor: pointer !important;
                            transition: all 0.3s ease !important;
                            min-width: 120px !important;
                        "
                        onmouseover="this.style.background='rgba(0, 255, 136, 0.3)'; this.style.transform='scale(1.05)'"
                        onmouseout="this.style.background='rgba(0, 255, 136, 0.2)'; this.style.transform='scale(1)'"
                        class="info-line">
                            <div style="
                                font-size: 16px !important;
                                color: #00ff88 !important;
                                font-weight: bold !important;
                                font-family: 'Bungee', monospace !important;
                            ">\u{1F48E} $5 Challenge</div>
                            <div style="
                                font-size: 12px !important;
                                color: #ffffff !important;
                                font-family: 'Bungee', monospace !important;
                            ">Winner gets $9.00</div>
                        </button>
                    </div>
                    
                    <div style="
                        display: flex !important;
                        gap: 10px !important;
                        justify-content: center !important;
                        flex-wrap: wrap !important;
                    ">
                        <button id="shareScoreBtn" style="
                            background: none !important;
                            color: #00ff88 !important;
                            border: 1px solid #00ff88 !important;
                            padding: 10px 16px !important;
                            border-radius: 8px !important;
                            font-size: 12px !important;
                            cursor: pointer !important;
                            transition: all 0.3s ease !important;
                            font-family: 'Bungee', monospace !important;
                        "
                        onmouseover="this.style.backgroundColor='rgba(0, 255, 136, 0.1)'"
                        onmouseout="this.style.backgroundColor='transparent'"
                        class="info-line">
                            Share Score
                        </button>
                    </div>
                </div>
                
                <!-- PRIMARY ACTION BUTTONS -->
                <div style="
                    display: flex !important;
                    gap: 10px !important;
                    justify-content: center !important;
                    margin-bottom: 12px !important;
                    flex-wrap: wrap !important;
                ">
                    <button id="playAgainBtn" style="
                        background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%) !important;
                        color: #000000 !important;
                        border: none !important;
                        padding: 10px 20px !important;
                        border-radius: 8px !important;
                        font-size: 13px !important;
                        font-weight: bold !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                        box-shadow: 0 0 20px rgba(0, 212, 255, 0.4) !important;
                        min-width: 120px !important;
                    "
                    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 30px rgba(0, 212, 255, 0.6)'"
                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 20px rgba(0, 212, 255, 0.4)'"
                    class="info-line">
                        \u{1F504} PLAY AGAIN
                    </button>
                    
                    <button id="gamesBtn" style="
                        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%) !important;
                        color: #ffffff !important;
                        border: none !important;
                        padding: 10px 20px !important;
                        border-radius: 8px !important;
                        font-size: 13px !important;
                        font-weight: bold !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                        box-shadow: 0 0 20px rgba(255, 107, 107, 0.4) !important;
                        min-width: 120px !important;
                    "
                    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 0 30px rgba(255, 107, 107, 0.6)'"
                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 0 20px rgba(255, 107, 107, 0.4)'"
                    class="info-line">
                        \u{1F3AE} GAMES
                    </button>
                    
                    <button id="homeBtn" style="
                        background: none !important;
                        color: #ffaa00 !important;
                        border: 2px solid #ffaa00 !important;
                        padding: 10px 20px !important;
                        border-radius: 8px !important;
                        font-size: 13px !important;
                        font-weight: bold !important;
                        cursor: pointer !important;
                        transition: all 0.3s ease !important;
                        font-family: 'Bungee', monospace !important;
                        text-shadow: 0 0 10px #ffaa00 !important;
                        box-shadow: 0 0 15px rgba(255, 170, 0, 0.3) !important;
                        min-width: 120px !important;
                    "
                    onmouseover="this.style.backgroundColor='rgba(255, 170, 0, 0.1)'; this.style.boxShadow='0 0 25px rgba(255, 170, 0, 0.5)'"
                    onmouseout="this.style.backgroundColor='transparent'; this.style.boxShadow='0 0 15px rgba(255, 170, 0, 0.3)'"
                    class="info-line">
                        \u{1F3E0} HOME
                    </button>
                </div>
            </div>
        `;try{document.body.appendChild(r),this.log(this.LOG_LEVEL.INFO,"\u2705 Overlay with hard-coded medals created and added to document.body"),this.setupButtonHandlers(r,t)}catch(n){this.log(this.LOG_LEVEL.ERROR,"\u274C Error creating overlay with hard-coded medals:",n)}}updateOverlayWithPlayerInfo(t,e,o){this.log(this.LOG_LEVEL.INFO,"\u26A1 INSTANT: Updating overlay with player info");const r=document.getElementById("game-over-wrapper");if(!r){this.log(this.LOG_LEVEL.ERROR,"\u274C No game-over-wrapper found for player info update");return}const n=r.querySelector("#playerInfoSection");n&&(n.innerHTML=`
                <div style="
                    font-size: 14px !important;
                    color: #ffffff !important;
                    margin-bottom: 3px !important;
                    font-family: 'Bungee', monospace !important;
                " class="info-line">\u{1F464} ${e}</div>
            `,this.log(this.LOG_LEVEL.INFO,"\u2705 Player info updated in overlay"));const a=this.getLeaderboardForOverlay(t);a?(this.log(this.LOG_LEVEL.INFO,"\u{1F4CA} Updating overlay with cached leaderboard data"),this.updateLeaderboardInOverlay(a)):this.log(this.LOG_LEVEL.INFO,"\u{1F4CA} No cached data available, overlay will show hard-coded medals")}setupButtonHandlers(t,e){this.log(this.LOG_LEVEL.INFO,"\u{1F50D} Setting up button handlers for overlay...");const o=t.querySelector("#playAgainBtn");o?(this.log(this.LOG_LEVEL.INFO,"\u{1F3AE} Setting up Play Again button - will be updated with API data"),o.addEventListener("click",async s=>{if(this.log(this.LOG_LEVEL.INFO,"\u{1F3AE} Play Again button clicked"),s.stopPropagation(),o.disabled){this.log(this.LOG_LEVEL.INFO,"\u{1F3AF} Play Again button is disabled - ignoring click");return}this.leaderboardInstance&&this.leaderboardInstance.isVisible&&(this.log(this.LOG_LEVEL.INFO,"\u{1F3AE} Hiding leaderboard instance"),this.leaderboardInstance.hide()),this.hide(),this.log(this.LOG_LEVEL.INFO,"\u{1F3AE} Play Again clicked - starting new game"),this.eventBus.emit("startGame")})):this.log(this.LOG_LEVEL.ERROR,"\u274C Play Again button not found!");const r=t.querySelector("#homeBtn");r&&r.addEventListener("click",()=>{this.log(this.LOG_LEVEL.INFO,"\u{1F3E0} Home button clicked"),this.hide(),window.location.href="/"});const n=t.querySelector("#viewLeaderboardBtn");n&&(this.log(this.LOG_LEVEL.INFO,"\u{1F3C6} Setting up Leaderboard button listener"),n.addEventListener("click",s=>{this.log(this.LOG_LEVEL.INFO,"\u{1F3C6} Leaderboard button clicked - showing leaderboard"),s.stopPropagation(),this.showStyledLeaderboard()}));const a=t.querySelector("#challenge2Btn");a&&a.addEventListener("click",s=>{this.log(this.LOG_LEVEL.INFO,"\u{1F4B0} $2 Challenge button clicked"),s.stopPropagation(),this.createChallenge(e,2)});const i=t.querySelector("#challenge5Btn");i&&i.addEventListener("click",s=>{this.log(this.LOG_LEVEL.INFO,"\u{1F48E} $5 Challenge button clicked"),s.stopPropagation(),this.createChallenge(e,5)});const d=t.querySelector("#shareScoreBtn");d&&d.addEventListener("click",s=>{this.log(this.LOG_LEVEL.INFO,"\u{1F4E4} Share Score button clicked"),s.stopPropagation(),this.shareScore(e)});const c=t.querySelector("#gamesBtn");c&&c.addEventListener("click",s=>{this.log(this.LOG_LEVEL.INFO,"\u{1F3AE} Games button clicked"),s.stopPropagation(),this.hide(),window.location.href="/games/"})}getLeaderboardForOverlay(t){return this.cachedLeaderboardData&&this.cachedLeaderboardData.score===t?(this.log(this.LOG_LEVEL.INFO,"\u{1F4CA} Using cached leaderboard data for overlay"),this.cachedLeaderboardData):this.apiCallInProgress&&this.currentGameScore===t?(this.log(this.LOG_LEVEL.INFO,"\u23F3 API call in progress, waiting for result..."),null):(this.log(this.LOG_LEVEL.WARN,"\u274C No leaderboard data available for overlay"),null)}}export{B as GameOverSystem};
